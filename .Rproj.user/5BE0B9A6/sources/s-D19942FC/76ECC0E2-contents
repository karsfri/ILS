---
title: "demo_automation"
author: "Kári"
date: "1/6/2020"
output: html_document
---

```{r setup, include=FALSE,echo=FALSE}

# set template
source("https://github.com/karsfri/ILS/raw/master/theme_hms.R")
source("https://github.com/karsfri/ILS/raw/master/demo_automation.R", encoding = "UTF-8")
theme_set_hms()

library(tidyverse)

# Þannig að mánaðarnöfnin koma rétt
Sys.setenv(LANGUAGE="is")
Sys.setlocale("LC_TIME", "Icelandic")

knitr::opts_chunk$set(
	echo = TRUE,
	fig.width = 18/2.54,
	message = FALSE,
	warning = FALSE,
	include = TRUE,
	dpi = 300,
	dev.args=list(bg="white")
)

```

# Dæmi um sjálfvirkni

Hér er dæmi um það hvernig má nýta sjálfvirka uppfærslu gagna og mynda. Notast er við föll sem búa í möppunni *demo_automation.R*. Það skilar gögnunum og prentar myndina.

```{r}
df <- yfirverd()
```

Fallið *yfirverd* tekur einnig við nafn á hópabreytum (e. *group variables*) sem argumenti:

```{r}
df_landshluti <- yfirverd(Landshluti)
```

Með argumentinu *eftir* má setja inn í titil eftir hvaða hópum myndunum er skipt:

```{r}
df3 <- yfirverd(SerbyliFjolbyli, eftir = "tegund húsnæðis")

```


Hægt er að koma í veg fyrir að plotið prentist með því að setja *print_plot = FALSE*. Þá skilar fallið bara gögnun

```{r}
yfirverd(print_plot = FALSE, Landshluti)

```

Þetta getur t.d. verið hjálplegt þegar nýta á gögnin áfram eða ef að breyta á plottinu. Þá er hægt að plotta frá grunni eða nýta fallið *plot_yfirverd* sem að skilar plotinu með sama hætti og *yfirverd* fallið nema ekki eftir facetum.

```{r}
yfirverd(Landshluti, print_plot = FALSE) %>% 
  plot_yfirverd(title = "Þetta er titill") +
  facet_wrap(~Landshluti, ncol = 2)
```
Eða:

```{r}
windowsFonts(Chiller = windowsFont("Chiller"))


yfirverd(Landshluti, print_plot = FALSE) %>% 
  plot_yfirverd(title = "Þetta er titill") +
  facet_wrap(~Landshluti, ncol = 2) +
  scale_fill_viridis_d(option = "C") + 
  theme(
    text = element_text(family = "Chiller"),
    plot.title = element_text(family = "Chiller"),
    plot.subtitle = element_text(family = "Chiller"),
    strip.text = element_text(family = "Chiller"),
    strip.text.x = element_text(family = "Chiller"),
    plot.caption = element_text(family = "Chiller"),
    )
```

Hægt er að bæta við filterum í argumentið *filters* en passa þarf að það sé inní *quos* falli, því annars kemur villa.

```{r}
df3 <- yfirverd(
  SerbyliFjolbyli, 
  eftir = "tegund húsnæðis", 
  filters = quos(
    SerbyliFjolbyli != "Annað", 
    SerbyliFjolbyli != "Sérhæft íbúðarhúsnæði")
  )

```

## Vista skjöl

Seinustu mynd má vista með *save_both* fallinu úr *theme_hms*:

```{r}
ggsave_both("yfir")
```


Að lokum er hægt að sjá gögnin sem notuð eru til útreikninganna með fallinu *yfirverd_get_data*

```{r}
yfirverd_get_data()
```

