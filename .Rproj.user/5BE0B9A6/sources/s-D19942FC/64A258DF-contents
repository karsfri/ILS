df_fast_allt %>% 
  filter(SerbyliFjolbyli != "Annað") %>% 
  mutate(staerd = cut(Flatarmal, breaks = seq(0, 300, by = 20))) %>% 
  group_by(Landshlutaflokkun, SerbyliFjolbyli, Stig) %>% 
  summarise(
    fjoldi = n()
  ) %>% 
  ungroup() %>% 
  mutate(
    Landshlutaflokkun = Landshlutaflokkun %>% str_wrap(12) %>% fct_reorder(-fjoldi, sum),
    SerbyliFjolbyli = SerbyliFjolbyli %>% str_wrap(12) %>% fct_reorder(-fjoldi, sum)
  ) %>% 
  filter(Landshlutaflokkun != "Vantar") %>%
  group_by(Landshlutaflokkun, Stig, staerd) %>% 
  mutate(rat = fjoldi / sum(fjoldi)) %>%
  ggplot(aes(x = Stig, y = rat, fill = SerbyliFjolbyli)) +
  geom_col() +
  scale_y_continuous(labels = scales::percent_format(big.mark = ".", decimal.mark = ",")) +
  scale_fill_manual(values = palette_report, guide = guide_legend(ncol = 2)) +
  theme_report +
  labs(
    title = "Samsetning íbúðastofnins og íbúða í byggingu",
    x = NULL, y = NULL,
    caption = "Heimild: Þjóðskrá Íslands"
  ) +
  facet_wrap(~Landshlutaflokkun, strip.position = "left") +
  theme(
    axis.text.x = element_text(angle = 90, vjust = 0.4, hjust = 1),
    strip.text.y = element_text(angle = -90, hjust = 0)
  ) 
